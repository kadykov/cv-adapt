---
import BaseLayout from '../layouts/BaseLayout.astro';
import { AuthenticatedLoginForm } from '../features/auth/components/AuthenticatedContent';

// Check if user is already authenticated
const authToken = Astro.cookies.get('auth_token')?.value;
const userJson = Astro.cookies.get('auth_user')?.value;
let initialUser = null;
try {
    initialUser = userJson ? JSON.parse(userJson) : null;
} catch (e) {
    // Invalid user JSON, clear cookies
    Astro.cookies.delete('auth_token');
    Astro.cookies.delete('auth_user');
}

// Redirect to jobs if already authenticated
if (authToken && initialUser) {
    return Astro.redirect('/jobs');
}
---

<BaseLayout title="Login">
    <AuthenticatedLoginForm client:load />
</BaseLayout>
